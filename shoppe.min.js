window.shoppeJs=function(){function t(){for(var a=0;a<c.getCartTotalList().length;a++)c.getCartTotalList()[a].innerHTML=v(b.getOptions().currency)+parseFloat(b.getCartTotal()).toFixed(2);for(a=0;a<c.getShopItemCountList().length;a++)c.getShopItemCountList()[a].innerHTML=b.getItems().length;for(a=0;a<c.getCartViewList().length;a++){var l=c.getCartViewList()[a],d=null===g.getElementById(c.cartList)?g.createElement("table"):g.getElementById(c.cartList),f=null===g.getElementById(c.cartHeadings)?g.createElement("thead"):
g.getElementById(c.cartHeadings);d.id=c.cartList;d.style="display: table; border-spacing: 2px; border-color: grey; width: 100%; text-align: left";0===f.id.length&&(f.id=c.cartHeadings,f.appendChild(B()),d.appendChild(f));var e=[];if(0===b.getItems().length){if(null!==d)for(;d.firstChild;)d.removeChild(d.firstChild)}else if(null!==d)for(f=0;f<d.children.length;f++){var k=d.children[f];k.id!==c.cartHeadings&&!1===x(k,b.getItems(),"id")&&e.push(k)}for(f=0;f<e.length;f++)d.removeChild(e[f]);for(f=0;f<
b.getItems().length;f++)if(e=b.getItems()[f],k=null===g.getElementById(c.cartItem+e.getId())?g.createElement("tr"):g.getElementById(c.cartItem+e.getId()),k.id!==c.cartItem+e.getId()){var e=k,k=b.getItems()[f],h=void 0,q=void 0,p=void 0,n=void 0,m=void 0,h=g.createElement("td");h.innerHTML=k.getName();h.style="padding-right: 5px";p=g.createElement("td");p.innerHTML=v(b.getOptions().currency)+k.getPrice().toFixed(2);p.style="padding-right: 5px";m=g.createElement("td");m.innerHTML=k.getQuantity();m.style=
"padding-right: 5px";m.id=c.cartItem+k.getId()+"q";n=g.createElement("td");q=g.createElement("span");q.innerHTML="Remove";q.style="text-decoration: underline; cursor: pointer";q.onclick=C(k);n.appendChild(q);e.id=c.cartItem+k.getId();e.appendChild(h);e.appendChild(p);e.appendChild(m);e.appendChild(n);d.appendChild(e)}else for(h=0;h<k.children.length;h++)q=k.children[h],q.id.substring(0,q.id.length-1)===k.id&&(q.innerHTML=e.getQuantity());l.appendChild(d)}y(parseFloat(b.getCartTotal()).toFixed(2))}
function x(a,b,d){for(var f=!1,e=0;e<b.length;e++)if(a[d]===b[e][d]||a[d]===c.cartItem+b[e][d])f=!0;return f}function D(a){return function(){var l=a,l=new h(l);if(x(l,b.getItems(),"id"))for(var d=0;d<b.getItems().length;d++){if(l.getId()===b.getItems()[d].getId()){b.getItems()[d].setQuantity(b.getItems()[d].getQuantity()+1);b.total=parseFloat(b.total);b.total+=l.getPrice();b.total.toFixed(2);break}}else l.setQuantity(1),b.getItems().push(l),b.total=parseFloat(b.total),b.total+=l.getPrice(),b.total.toFixed(2);
p.setItem(c.itemsStorage,JSON.stringify(b.getItems()));t()}}function C(a){return function(){for(var l=0;l<b.getItems().length;l++)if(b.getItems()[l].getId()===a.getId()){1===a.getQuantity()?b.getItems().splice(l,1):b.getItems()[l].setQuantity(a.getQuantity()-1);b.total=parseFloat(b.total);b.total-=a.getPrice();b.total.toFixed(2);break}p.setItem(c.itemsStorage,JSON.stringify(b.getItems()));t()}}function h(a){if(void 0===a)return console.error("shoppeJs: Empty item"),{};this.id=void 0!==a.id?a.id:null;
this.name=void 0!==a.name?a.name:null;this.description=void 0!==a.description?a.description:null;this.price=void 0!==a.price?a.price:null;this.quantity=void 0!==a.quantity?a.quantity:null;this.element=void 0!==a.element?a.element:null}function n(){this.itemMainName="shoppe-item";this.itemName="item-name";this.itemDescription="item-description";this.itemPrice="item-price";this.optionsStorage="shoppe-options";this.itemsStorage="shoppe-items";this.itemCount="shoppe-item-count";this.addCallback="shoppe-add";
this.cartView="shoppe-cart";this.cartHeadings="shoppe-cart-heading";this.cartList="shoppe-cart-list";this.cartItem="shoppe-cart-item-";this.cartTotal="shoppe-cart-total";this.shopItemList=[];this.shopItemCountList=[];this.cartTotalList=[];this.cartViewList=[];this.zero="0.00"}function B(){var a=g.createElement("tr"),b=g.createElement("th"),c=g.createElement("th"),f=g.createElement("th"),e=g.createElement("th");b.innerHTML="Name";c.innerHTML="Cost";f.innerHTML="Quantity";e.innerHTML="";a.appendChild(b);
a.appendChild(c);a.appendChild(f);a.appendChild(e);return a}function y(a){null!==r&&(r.open("POST","dataStore.php",!0),r.send(a))}function z(){m.open("GET","dataStore.php?"+Math.random(),!0);m.send()}function v(a){switch(a){case "GBP":a="&pound;";break;case "USD":a="$";break;default:a="$"}return a}var c=new n,p=window.sessionStorage,g=document,u={currency:"GBP",payment:{type:"Paypal",username:""}},m=new XMLHttpRequest,r=new XMLHttpRequest,A=0;m.onreadystatechange=function(){4===m.readyState&&200===
m.status&&m.responseText&&(A=parseFloat(m.responseText))};z();r.onreadystatechange=function(){4===m.readyState&&200===m.status&&z()};var b={init:function(a){var l=[];c.setShopItemList(g.getElementsByClassName(c.itemMainName));c.setShopItemCountList(g.getElementsByClassName(c.itemCount));c.setCartTotalList(g.getElementsByClassName(c.cartTotal));c.setCartViewList(g.getElementsByClassName(c.cartView));b.total=c.zero;y(b.total);void 0===a&&(a={},void 0!==p.getItem(c.optionsStorage)&&(a=JSON.parse(p.getItem(c.optionsStorage)),
null===a&&(a={})));for(var d in a)a.hasOwnProperty(d)&&(u[d]=a[d]);a=u;d=[];if(void 0!==p.getItem(c.itemsStorage)){var f=[],f=""===p.getItem(c.itemsStorage)?[]:JSON.parse(p.getItem(c.itemsStorage));null===f&&(f=[]);for(var e=0;e<f.length;e++){var k=new h(f[e]);d.push(new h(k));b.total=parseFloat(b.total);b.total+=k.getPrice()*k.getQuantity();b.total.toFixed(2)}}b.options=a;b.items=d;p.setItem(c.optionsStorage,JSON.stringify(a));for(a=0;a<c.getShopItemList().length;a++){d=c.getShopItemList()[a];for(var m,
n,r,w,f=0;f<d.children.length;f++)e=d.children[f],e.id===c.itemName&&(m=e),e.id===c.itemDescription&&(n=e),e.id===c.itemPrice&&(r=e),e.id===c.addCallback&&(w=e);d=new h({id:d.id,name:m.innerHTML,description:n.innerHTML,price:parseFloat(r.innerHTML),element:d});l.push(d);w&&(w.onclick=D(d));r.innerHTML=v(b.getOptions().currency)+r.innerHTML}t()},getOptions:function(){return b.options},setOptions:function(a){for(var c in a)a.hasOwnProperty(c)&&(u[c]=a[c]);b.options=u},checkout:function(a){void 0===
a&&b.getItems();0===b.total||b.total===c.zero?alert("Your basket is empty."):A!==b.total&&(alert("Item values have changed in your basket, not proceeding with checkout!"),b.clearItems())},getItems:function(){return b.items},getCartTotal:function(){return b.total},clearItems:function(){b.items.length=0;b.items=[];b.total=c.zero;p.setItem(c.itemsStorage,"");t()},dispose:function(){p.clear();b.items=[];b.options=[];b.total=c.zero}};h.prototype.getId=function(){return this.id};h.prototype.setId=function(a){this.id=
a};h.prototype.getName=function(){return this.name};h.prototype.setName=function(a){this.name=a};h.prototype.getQuantity=function(){return this.quantity};h.prototype.setQuantity=function(a){this.quantity=a};h.prototype.getPrice=function(){return this.price};h.prototype.setPrice=function(a){this.price=a};n.prototype.getShopItemList=function(){return this.shopItemList};n.prototype.setShopItemList=function(a){this.shopItemList=a};n.prototype.getShopItemCountList=function(){return this.shopItemCountList};
n.prototype.setShopItemCountList=function(a){this.shopItemCountList=a};n.prototype.getCartViewList=function(){return this.cartViewList};n.prototype.setCartViewList=function(a){this.cartViewList=a};n.prototype.getCartTotalList=function(){return this.cartTotalList};n.prototype.setCartTotalList=function(a){this.cartTotalList=a};return b}();